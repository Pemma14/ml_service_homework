import streamlit as st
from webview.core.config import ICONS
from webview.core.styles import metric_card
from webview.core.utils import requests_to_df
from webview.services.state import handle_api_error

def render_overview(api):
    try:
        # –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        st.markdown(f"#### {ICONS['history']} –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã")
        requests = api.get_request_history()
        if requests:
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
            df = requests_to_df(requests[:10])
            st.dataframe(df, use_container_width=True, hide_index=True)
            st.caption("–ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–µ")
        else:
            st.info("–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—É—Å—Ç–∞. –°–¥–µ–ª–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤–æ –≤–∫–ª–∞–¥–∫–µ '–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ'!")

        # –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        st.markdown("---")
        st.markdown(f"#### üìñ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")
        with st.expander("–ö–∞–∫ –ø–æ–Ω–∏–º–∞—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞—Ç—É—Å—ã?", expanded=True):
            st.markdown("""
            –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è ‚Äî —ç—Ç–æ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ –≤ —Ç–æ–º, —á—Ç–æ —É –ø–∞—Ü–∏–µ–Ω—Ç–∞ –º–æ–≥—É—Ç –ø—Ä–æ—è–≤–∏—Ç—å—Å—è –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã.

            *   **0.0 ‚Äî 0.3 (–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫):** –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –º–∞–ª–∞. –î–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–æ—Ñ–∏–ª—è–º, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–¥–∫–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏.
            *   **0.3 ‚Äî 0.7 (–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫):** –ü–æ–≥—Ä–∞–Ω–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–≤—ã—à–µ–Ω–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø–∞—Ü–∏–µ–Ω—Ç–∞ –≤ –Ω–∞—á–∞–ª–µ —Ç–µ—Ä–∞–ø–∏–∏.
            *   **0.7 ‚Äî 1.0 (–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫):** –í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–∏—Ç–∏—è –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã—Ö –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

            **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è–Ω–∏—è:**
            *   **–ì–µ–Ω–µ—Ç–∏–∫–∞ (CYP2C19, CYP2D6):** –û–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞. "–ú–µ–¥–ª–µ–Ω–Ω—ã–µ" –º–µ—Ç–∞–±–æ–ª–∏–∑–∞—Ç–æ—Ä—ã –∏–º–µ—é—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫.
            *   **–ö–ª–æ–∑–∞–ø–∏–Ω:** –°–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∞—è —Ç–µ—Ä–∞–ø–∏—è –º–æ–∂–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å —Ñ–∞—Ä–º–∞–∫–æ–∫–∏–Ω–µ—Ç–∏–∫—É.
            *   **–í–æ–∑—Ä–∞—Å—Ç:** –í–ª–∏—è–µ—Ç –Ω–∞ –æ–±—â—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –∫ —ç–ª–∏–º–∏–Ω–∞—Ü–∏–∏ –ª–µ–∫–∞—Ä—Å—Ç–≤.
            """)

    except Exception as e:
        handle_api_error(e)
